package postgres

import (
	"context"
	"exploit_runner/internal/models"
)

func (s *Storage) GetRunningExploits(ctx context.Context) ([]*models.Exploit, error) {
	rows, err := s.db.Query(ctx, `SELECT id, name, type, is_local, executable_path, requirements_path FROM exploits WHERE is_running = true`)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var exploits []*models.Exploit
	for rows.Next() {
		var exploit models.Exploit
		if err := rows.Scan(&exploit.ID, &exploit.Name, &exploit.Type, &exploit.IsLocal, &exploit.ExecutablePath, &exploit.RequirementsPath); err != nil {
			return nil, err
		}
		exploits = append(exploits, &exploit)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return exploits, nil
}
