package jacfarm

import (
	"JacFARM/internal/http/dto"
	"JacFARM/internal/models"
	"context"
	"log/slog"

	"github.com/jacute/prettylogger"
)

func (s *Service) ListExploits(ctx context.Context, filter *dto.ListExploitsFilter) ([]*models.Exploit, error) {
	const op = "service.jacfarm.ListExploits"
	log := s.log.With(slog.String("op", op))

	exploits, err := s.db.GetExploits(ctx, filter)
	if err != nil {
		log.Error("error listing exploits", prettylogger.Err(err))
		return nil, err
	}
	log.Info("successfully list exploits")

	return exploits, nil
}

func (s *Service) ToggleExploit(ctx context.Context, id string) (bool, error) {
	const op = "service.jacfarm.ToggleExploit"
	log := s.log.With(slog.String("op", op))

	isRunning, err := s.db.ToggleExploit(ctx, id)
	if err != nil {
		log.Error("error toggling exploit", prettylogger.Err(err))
		return false, err
	}
	log.Info("exploit successfully toggled", slog.Bool("is_running", isRunning))

	return isRunning, nil
}
